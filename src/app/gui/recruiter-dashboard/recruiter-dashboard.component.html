<header class="main-header mb-2">
  <div class="main-content pb-0">
    <div class="row align-items-end justify-content-between mb-3">
      <div class="col-auto">
        <h1 class="main-title">Recruiter dashboard</h1>
      </div>
    </div>
  </div>
</header>

<div class="main-content box">

  <header class="px-4 mb-3">
    <div class="row align-items-end" appKeyListener [enterKeyFunction]="searchWithFilter.bind(this)">
      <div class="col-auto mb-3">
        <div>
          <label class="label-sm" for="search-engine">Candidate</label>
          <div class="input-group">
            <div class="input-group-prepend">
              <div class="input-group-text"><i class="fas fa-search"></i></div>
            </div>
            <input type="text" class="form-control"
                   id="search-engine" maxlength="150" style="width: 15rem;"
                   [maxLength]="150" [(ngModel)]="candidateFilter.fullNameSearch">
          </div>
        </div>
      </div>
      <div class="col-auto mb-3">
        <label class="label-sm">Company</label>
        <ng-select (ngModelChange)="changeCompany($event)"
                   [(ngModel)]="candidateFilter.companies"
                   [items]="companies"
                   [multiple]="true"
                   [virtualScroll]="true"
                   [placeholder]="'Select company'">
          <ng-template let-clear="clear" let-items="items" ng-multi-label-tmp>
            <div *ngFor="let item of items | slice:0:1" class="ng-value">
              <span (click)="clear(item)" aria-hidden="true" class="ng-value-icon left">×</span>
              <span class="ng-value-label">
                    {{item}}
                  </span>
            </div>
            <div *ngIf="items.length > 1" class="ng-value">
              <span class="ng-value-label">+{{items.length - 1}}</span>
            </div>
          </ng-template>
          <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
            <input [ngModel]="item$.selected" id="item-option-company-{{index}}" type="checkbox"/> {{item}}
          </ng-template>
        </ng-select>
      </div>
      <div class="col-auto mb-3">
        <label class="label-sm">SR Status</label>
        <ng-select (ngModelChange)="changeStatus($event)"
                   [(ngModel)]="candidateFilter.statusIds"
                   [items]="subStatuses"
                   [multiple]="true"
                   [placeholder]="'Select status'"
                   groupBy="hiringProcess"
                   bindLabel="status"
                   bindValue="id">
          <ng-template let-clear="clear" let-items="items" ng-multi-label-tmp>
            <div *ngFor="let item of items | slice:0:1" class="ng-value">
              <span (click)="clear(item)" aria-hidden="true" class="ng-value-icon left">×</span>
              <span class="ng-value-label">
                    {{item.status}} - {{item.hiringProcess}}
                  </span>
            </div>
            <div *ngIf="items.length > 1" class="ng-value">
              <span class="ng-value-label">+{{items.length - 1}}</span>
            </div>
          </ng-template>
          <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
            <input [ngModel]="item$.selected" id="item-option-status-{{index}}" type="checkbox"/> {{item.status}}
          </ng-template>
        </ng-select>
      </div>
      <div class="col-auto mb-3">
        <label class="label-sm">SR jobs</label>
        <ng-select (ngModelChange)="changeJobs($event)"
                   [(ngModel)]="candidateFilter.jobIds"
                   [items]="jobs"
                   [multiple]="true"
                   [virtualScroll]="true"
                   [placeholder]="'Select job'"
                   bindLabel="title"
                   bindValue="id">
          <ng-template let-clear="clear" let-items="items" ng-multi-label-tmp>
            <div *ngFor="let item of items | slice:0:1" class="ng-value">
              <span (click)="clear(item)" aria-hidden="true" class="ng-value-icon left">×</span>
              <span class="ng-value-label">
                    {{item.title}}
                  </span>
            </div>
            <div *ngIf="items.length > 1" class="ng-value">
              <span class="ng-value-label">+{{items.length - 1}}</span>
            </div>
          </ng-template>
          <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
            <input [ngModel]="item$.selected" id="item-option-job-{{index}}" type="checkbox"/> {{item.title}}
          </ng-template>
        </ng-select>
      </div>
      <div class="col-auto mb-3">
        <label class="label-sm">Last request</label>
        <ng-select (ngModelChange)="changeLastRequest($event)"
                   [(ngModel)]="candidateFilter.lastRequests"
                   [items]="lastRequests"
                   [multiple]="true"
                   [placeholder]="'Select last request'">
          <ng-template let-clear="clear" let-items="items" ng-multi-label-tmp>
            <div *ngFor="let item of items | slice:0:1" class="ng-value">
              <span (click)="clear(item)" aria-hidden="true" class="ng-value-icon left">×</span>
              <span class="ng-value-label">
                    {{item}}
                  </span>
            </div>
            <div *ngIf="items.length > 1" class="ng-value">
              <span class="ng-value-label">+{{items.length - 1}}</span>
            </div>
          </ng-template>
          <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
            <input [ngModel]="item$.selected" id="item-option-last-request-{{index}}" type="checkbox"/> {{item}}
          </ng-template>
        </ng-select>
      </div>
      <div class="col-auto mb-3">
        <label class="label-sm">Request author</label>
        <ng-select (ngModelChange)="changeRequestAuthor($event)"
                   [(ngModel)]="candidateFilter.requestAuthors"
                   [items]="requestAuthors"
                   [multiple]="true"
                   [placeholder]="'Select request author'">
          <ng-template let-clear="clear" let-items="items" ng-multi-label-tmp>
            <div *ngFor="let item of items | slice:0:1" class="ng-value">
              <span (click)="clear(item)" aria-hidden="true" class="ng-value-icon left">×</span>
              <span class="ng-value-label">
                    {{item}}
                  </span>
            </div>
            <div *ngIf="items.length > 1" class="ng-value">
              <span class="ng-value-label">+{{items.length - 1}}</span>
            </div>
          </ng-template>
          <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
            <input [ngModel]="item$.selected" id="item-option-request-author-{{index}}" type="checkbox"/> {{item}}
          </ng-template>
        </ng-select>
      </div>
      <div class="col-auto mb-3">
        <button (click)="searchWithFilter()" class="btn btn-primary text-nowrap">
          <i class="fa fa-search"></i>
          Search
        </button>
      </div>
    </div>
  </header>
  <div class="table-responsive" style="overflow-x: initial;">
    <table class="table table-full">
      <thead>
      <tr>
        <th scope="col"><span (click)="changeSort('candidate')" class="sort-column"> Candidate  <i
          class="fas {{
          candidateFilter.sortingRow==='candidate'?!candidateFilter.ascending?'fa-sort-up':'fa-sort-down':'fa-sort'}}"
        ></i></span></th>
        <th scope="col"><span (click)="changeSort('status')" class="sort-column"> SR status <i
          class="fas {{ candidateFilter.sortingRow==='status'?!candidateFilter.ascending?'fa-sort-up':'fa-sort-down':'fa-sort'}}"
        ></i></span></th>
        <th scope="col"><span (click)="changeSort('jobTitle')" class="sort-column"> SR job <i
          class="fas {{ candidateFilter.sortingRow==='jobTitle'?!candidateFilter.ascending?'fa-sort-up':'fa-sort-down':'fa-sort'}}"
        ></i></span></th>
        <th scope="col"><span (click)="changeSort('company')" class="sort-column"> SR Brand name  <i
          class="fas {{
          candidateFilter.sortingRow==='company'?!candidateFilter.ascending?'fa-sort-up':'fa-sort-down':'fa-sort'}}"
        ></i></span></th>
        <th scope="col"><span (click)="changeSort('lastRequest')" class="sort-column"> Last request <i
          class="fas {{ candidateFilter.sortingRow==='lastRequest'?!candidateFilter.ascending?'fa-sort-up':'fa-sort-down':'fa-sort'}}"
        ></i></span></th>
        <th scope="col"><span (click)="changeSort('requestAuthor')" class="sort-column"> Request author <i
          class="fas {{ candidateFilter.sortingRow==='requestAuthor'?!candidateFilter.ascending?'fa-sort-up':'fa-sort-down':'fa-sort'}}"
        ></i></span></th>

        <th class="text-right" scope="col" style="width: 20em;"></th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let candidate of candidates.content">
        <td>
          <a target="_blank" [href]="'https://www.smartrecruiters.com/app/people/candidates/' + candidate.srCandidateId">
            {{candidate.fullName}}
          </a>
        </td>
        <td>{{candidate.subStatus}}</td>
        <td>
          <a [href]="SR_JOB_DETAILS_URL + candidate.srJobId" target="_blank">{{candidate.jobTitle}}</a>
        </td>
        <td>{{candidate.company}}</td>
        <td>{{candidate.lastRequest}}</td>
        <td>{{candidate.requestAuthor}}</td>
        <td class="text-right">
          <div class="dropdown d-inline-block">
            <button aria-expanded="false" aria-haspopup="true"
                    class="btn btn-sm btn-basic dropdown-toggle mb-2" data-toggle="dropdown" type="button">
              Request
            </button>
            <div class="dropdown-menu dropdown-menu-right cursor-pointer">
              <button (click)="navigateToCreateRequest(candidate)" class="dropdown-item" title="Create an offer" type="button">
                Create an offer
              </button>
              <button [disabled]="!candidate.lastRequest"  class="dropdown-item" title="Update an offer" type="button"
                      (click)="openUpdateOfferMailModal(candidate)">
                Update an offer
              </button>
              <button [disabled]="!candidate.lastRequest" class="dropdown-item" title="Create a contract" type="button"
              (click)="openCreateContractMailModal(candidate)">
                Create a contract
              </button>
              <button [disabled]="!candidate.lastRequest" *ngIf="candidate.isBelgianEntity" class="dropdown-item" title="Ask for work permit" type="button"
              (click)="openAsKWorkPermitMailModal(candidate)">
                Ask for work permit
              </button>
            </div>
          </div>
          <button *ngIf="candidate.candidateAccount" type="button" class="btn btn-basic btn-sm ml-3 mb-2"
                  (click)="openResourceForCandidate(candidate)">
            Go to Usource
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
  <div *ngIf="candidates.content.length>0" class="d-flex justify-content-end pt-4 px-4">

    <select (change)="changePageSize()" [(ngModel)]="pageSize" class="form-control input-sm "
            style="max-width: 5vw;display: inline;margin-right: auto;">
      <option selected value="25">25</option>
      <option value="50">50</option>
      <option value="100">100</option>
    </select>

    <nav aria-label="Page navigation">
      <ul *ngIf="candidates.first&&!candidates.last" class="pagination">
        <li class="page-item">
          <button aria-label="Previous" class="page-link">
            <span aria-hidden="true">&laquo;</span>
          </button>
        </li>
        <li class="page-item active">
          <button class="page-link">{{candidates.number + 1}}<span class="sr-only">(current)</span></button>
        </li>
        <li *ngIf="candidates.totalPages>=candidates.number+2" class="page-item">
          <button (click)="changePage(candidates.number +1)"
                  class="page-link">{{candidates.number + 2}}</button>
        </li>
        <li *ngIf="candidates.totalPages>=candidates.number+3" class="page-item">
          <button (click)="changePage(candidates.number+2)" class="page-link">{{candidates.number + 3}}</button>
        </li>
        <li class="page-item">
          <button (click)="changePage(candidates.number+1)" aria-label="Next" class="page-link">
            <span aria-hidden="true">&raquo;</span>
          </button>
        </li>
      </ul>
      <ul *ngIf="!candidates.first&&!candidates.last" class="pagination">
        <li class="page-item">
          <button (click)="changePage(candidates.number-1)" aria-label="Previous" class="page-link">
            <span aria-hidden="true">&laquo;</span>
          </button>
        </li>
        <li class="page-item ">
          <button (click)="changePage(candidates.number-1)"
                  class="page-link">{{candidates.number}}</button>
        </li>
        <li class="page-item active">
          <button class="page-link">{{candidates.number + 1}}<span class="sr-only">(current)</span></button>
        </li>
        <li class="page-item">
          <button (click)="changePage(candidates.number+1)"
                  class="page-link">{{candidates.number + 2}}</button>
        </li>
        <li class="page-item">
          <button (click)="changePage(candidates.number+1)" aria-label="Next" class="page-link">
            <span aria-hidden="true">&raquo;</span>
          </button>
        </li>
      </ul>
      <ul *ngIf="candidates.last" class="pagination">
        <li class="page-item">
          <button (click)="changePage(candidates.number-1>0?candidates.number-1:0)"
                  aria-label="Previous"
                  class="page-link">
            <span aria-hidden="true">&laquo;</span>
          </button>
        </li>
        <li *ngIf="candidates.number-1>0">
          <button (click)="changePage(candidates.number-2)"
                  class="page-link">{{candidates.number - 1}}</button>
        </li>
        <li *ngIf="candidates.number>0">
          <button (click)="changePage(candidates.number-1)" class="page-link">{{candidates.number}}</button>
        </li>
        <li class="page-item active">
          <button class="page-link ">{{candidates.number + 1}}<span class="sr-only">(current)</span></button>
        </li>
        <li class="page-item">
          <button aria-label="Next" class="page-link">
            <span aria-hidden="true">&raquo;</span>
          </button>
        </li>
      </ul>
    </nav>
  </div>

</div>
